<html>
<head>
  <title>Peer Connection Sample Code</title>
  <script src='lib/handler/queue.js'></script>
  <script src='lib/third_party/angular/angular-1.3.0-beta15.min.js'></script>
  <script src='lib/peerconnection/third_party/adapter.js'></script>
  <script src='lib/peerconnection/datachannel.js'></script>
  <script src='lib/peerconnection/peerconnection.js'></script>
  <style>
    div.info {
      font-family: monospace;
    }
    div#status {
      padding: 5px;
      width: 790px;
      border: 2px solid #DDD;
      margin: 5px;
    }
    div#errors {
      padding: 5px;
      width: 790px;
      border: 2px solid #922;
      background: #FCC;
      margin: 5px;
    }
    div#connect {
    }
    div#connect textarea {
      width: 100%;
      font-family: monospace;
      resize:vertical;
    }
    div.card {
      display: inline-block;
      vertical-align:top;
      padding:5px;
      margin:5px;
      border: 2px solid #DDD;
    }
    div#local {
      width: 381px;
    }
    div#copy-information {
    }
    div#remote {
      width: 381px;
    }
    div#channels {
      border: 2px solid #DDD;
      margin: 5px;
      padding: 5px;
      width: 790px;
    }
    div.chat {
      border: 2px solid #DDD;
      margin: 5px;
      width: 800px;
    }
    div.messages {
      height: 10em;
      font-family: monospace;
      overflow: scroll;
    }
    div.channel-header {
      border-bottom: 1px solid #DDD;
      padding: 5px;
    }
    span.channel-label {
      font-family: monospace;
      font-weight: bold;
    }
    div.send {
      border-top: 1px solid #DDD;
      padding: 5px;
    }
    button.close-btn {
      position: relative;
      right: 5px;
    }
  </style>
</head>

<body ng-app="webrtcPcApp">
  <div ng-controller="webrtcPcController">

  <div id='status'>
    <div class='info' id='state'>{{state}}</div>
    <div class='info' id='connection-info' ng-hide='connectInfo === ""'>{{connectInfo}}</div>
  </div>

  <div class='info' id='errors' ng-hide='errors.length === 0'>
    <div ng-repeat='error in errors'>{{error}}</div>
    <button class='close-btn' id='clear-errors-btn' ng-click='clearErrors()'>clear</button>
  </div>

  <div id='connect'>
    <div class='card' id='local'>
      <button id='initiate-connection-btn' ng-click='initiateConnection()' ng-show='state === "WAITING."'>Initiate Connection</button>
      <div id='copy-information' ng-hide='state === "WAITING."'>
        <div>Local info:</div>
        <textarea id='copy' disabled ng-model='localInfo'></textarea>
        <div ng-show='state === "CONNECTED!" || state === "CONNECTING..."'>Send this text to the remote peer.</div>
      </div>
    </div>

    <div class='card' id='remote'>
      <div>Remote info:</div>
      <textarea id='paste' ng-model='remoteInfo' ng-disabled='state === "DISCONNECTED."'></textarea>
      <div ng-show='state === "CONNECTED!" || state === "WAITING." || state === "CONNECTING..."'>
        Paste text from the remote peer, then click Receive.
        <button id='receive-btn' ng-click='processRemoteSignallingMessages()'>Receive</button>
      </div>
    </div>
  </div>

  <div id='channels' ng-show='state === "CONNECTED!"'>
    Channel label: <input type='text' id='label' size='20' ng-model='newChannelLabel'></input>
    <button id='create-channel-btn' ng-click='createDataChannel(newChannelLabel)'>Create Channel</button>
  </div>

  <div id='channel-list'>
    <div class='chat' id='channel-hello' ng-repeat='(channelLabel, channel) in channels'>
      <div class='channel-header'>Channel Label: <span class='channel-label'>{{channel.label}}</span> ({{channel.state}})
        <button class='close-btn' ng-show='channel.state === "closed"'>remove</button>
        <button class='close-btn' ng-show='channel.state === "open"' ng-click='closeDataChannel(channelLabel)'>close</button>
      </div>
      <div class='messages'>
        <div ng-repeat='message in messages track by $index'>{{message}}</div>
      </div>
      <div class='send'>
        <input type='text' id='message' size='60' ng-model='chatMessage'></input>
        <button class='send-message-btn' ng-click='send(channel.label, chatMessage)'>Send</button>
      </div>
    </div>
  </div>

  </div>
  <!-- main.js references DOM el being created already -->
  <script src='main.js'></script>

</body>
</html>
